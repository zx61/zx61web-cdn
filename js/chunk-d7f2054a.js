import{d as L,e as Q,u as W,f as X,g as A,r as p,ac as Z,bH as h,E as m,o as ee,c as le,b as S,t as d,h as s,l as i,i as o,w as u,F as te,bD as ae,bI as oe,q as I,bJ as se,bK as re,z as ue}from"./chunk-a0327024.js";import{E as ne,a as de}from"./chunk-9834b50d.js";import{E as ie}from"./chunk-afa9a482.js";import{E as me}from"./chunk-9ab6077c.js";import{E as pe}from"./chunk-d22e67fd.js";import{a as ce,E as fe}from"./chunk-84999d20.js";import{E as ve,a as be}from"./chunk-a1e2e944.js";import"./chunk-150316ab.js";import{d as c,a as ge,b as R}from"./chunk-bb59191b.js";import"./chunk-9519ab40.js";import"./chunk-3b873247.js";import"./chunk-1bfc73b0.js";const we={class:"text_markedness"},_e=S("br",null,null,-1),Ye=L({__name:"index",setup(ye){const{t:l}=Q(),y=W(),$=X();y.getUserItem("type")!="account"&&$.push("/account");const b=A([]),E=p(!1),n=A({userName:"",emailCode:"",password:"",rePassword:""}),O=p(),g=p(l("utils.send")),T=A({userName:[{validator:(r,e,t)=>{e===""&&t(new Error(l("login.emailOrUserNameNull"))),ge(e)||t(new Error(l("login.errorEmailOrUserName"))),t()},trigger:"blur"}],emailCode:[{validator:(r,e,t)=>{e===""&&t(new Error(l("login.emailCodeNull"))),isNaN(Number(e))&&t(new Error(l("login.errorEmailCode"))),t()},trigger:"blur"}],password:[{validator:(r,e,t)=>{e===""&&t(new Error(l("login.passwordNull"))),R(e)||t(new Error(l("login.errorPassword"))),t()},trigger:"blur"}],rePassword:[{validator:(r,e,t)=>{e===""&&t(new Error(l("login.passwordNull"))),R(e)||t(new Error(l("login.errorPassword"))),e!=n.password&&t(new Error(l("login.eeSetPasswordNotMatch"))),t()},trigger:"blur"}]}),Y=async()=>{const r=await ae();if(r.data.data=="success"){if(m.success(l("login.sendCodeSuccess")),g.value!=l("utils.send")&&g.value!=l("utils.reSend"))return;let e=60;const t=()=>{--e>0?(g.value=e.toString(),setTimeout(t,1e3)):g.value=l("utils.reSend")};t()}else m.error(r.data.msg),r.data.msg=="sendEmailCode fail"&&m.error("server error")},B=async()=>{var t;if(!await((t=O.value)==null?void 0:t.validate(f=>(f||m.error(l("login.errorData")),f))))return;const e=await oe({userName:n.userName,emailCode:Number(n.emailCode),password:I(n.password,y.getUserItem("email")),rePassword:I(n.rePassword,c(y.getUserItem("birthday")).valueOf().toString())});e.data.msg?m.error(e.data.msg):(b.push({sercetKey:e.data.data.sercetKey,userName:e.data.data.userName,status:l("utils.normal")}),E.value=!1)},N=p(0),U=p({}),V=p(!1),v=p(100),k=p(c().toDate()),F=(r,e)=>{V.value=!0,U.value=r,N.value=e},K=()=>{v.value==999&&(v.value=c(k.value).valueOf()),v.value==1e3&&(v.value=c().add(100,"year").valueOf()),se({userName:U.value.userName,blockUp:v.value}).then(r=>{r.data.msg?m.error(r.data.msg):(m.success(l("utils.blockUp")+l("utils.success")),b[N.value].status=c(r.data.data.blockUp).valueOf()<c().valueOf()?l("utils.normal"):l("utils.blockUp")+"-->"+c(r.data.data.blockUp).format("YYYY-MM-DD HH:mm:ss"),V.value=!1)})},C=p(!1),x=p(""),M=(r,e)=>{C.value=!0,U.value=r,N.value=e},H=()=>{const r=y.getUserItem("email");if(x.value!=r)return m.error(l("login.errorData"));re({userName:U.value.userName}).then(e=>{e.data.msg?m.error(e.data.msg):(m.success(l("utils.delete")+l("utils.success")),b.splice(N.value,1),C.value=!1)})};return Z(()=>{h().then(r=>{r.data.msg?m.error(r.data.msg):r.data.data.forEach(t=>{const f=c(t.blockUp).valueOf()<c().valueOf()?l("utils.normal"):l("utils.blockUp")+"-->"+c(t.blockUp).format("YYYY-MM-DD HH:mm:ss");b.push({sercetKey:t.sercetKey,userName:t.userName,status:f})})})}),(r,e)=>{const t=ue,f=ve,q=be,w=me,_=ce,j=fe,D=pe,P=ne,z=ie,G=de;return ee(),le(te,null,[S("h1",null,d(s(l)("menu.subAccount")),1),S("div",we,[i(d(s(l)("utils.subAccountTip"))+" ",1),o(t,{type:"primary",style:{"margin-top":"1em","margin-bottom":"1em"},onClick:e[0]||(e[0]=a=>E.value=!0)},{default:u(()=>[i(d(s(l)("utils.create")+s(l)("menu.subAccount")),1)]),_:1})]),o(q,{data:b},{default:u(()=>[o(f,{type:"expand"},{default:u(a=>[i(d(s(l)("utils.sercetKey")+"  "+a.row.sercetKey),1)]),_:1}),o(f,{prop:"userName",label:s(l)("utils.userName")},null,8,["label"]),o(f,{prop:"status",label:s(l)("utils.status")},null,8,["label"]),o(f,{label:s(l)("utils.operation")},{default:u(a=>[o(t,{type:"primary",link:"",onClick:J=>F(a.row,a.$index)},{default:u(()=>[i(d(s(l)("utils.blockUp")),1)]),_:2},1032,["onClick"]),o(t,{type:"danger",link:"",onClick:J=>M(a.row,a.$index)},{default:u(()=>[i(d(s(l)("utils.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),o(D,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=a=>E.value=a),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:s(l)("utils.create")+s(l)("menu.subAccount")},{default:u(()=>[o(j,{style:{"max-width":"500px"},"label-width":"100px",model:n,rules:T,ref_key:"subAccountFormRef",ref:O},{default:u(()=>[o(_,{label:s(l)("utils.userName"),prop:"userName"},{default:u(()=>[o(w,{modelValue:n.userName,"onUpdate:modelValue":e[1]||(e[1]=a=>n.userName=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(_,{label:s(l)("utils.emailCode"),prop:"emailCode"},{default:u(()=>[o(w,{style:{width:"76%"},modelValue:n.emailCode,"onUpdate:modelValue":e[2]||(e[2]=a=>n.emailCode=a)},null,8,["modelValue"]),o(t,{style:{width:"20%",margin:"0 0 0 4%"},type:"primary",onClick:e[3]||(e[3]=a=>Y())},{default:u(()=>[i(d(g.value),1)]),_:1})]),_:1},8,["label"]),o(_,{label:s(l)("utils.password"),prop:"password"},{default:u(()=>[o(w,{modelValue:n.password,"onUpdate:modelValue":e[4]||(e[4]=a=>n.password=a),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),o(_,{label:s(l)("utils.rePassword"),prop:"rePassword"},{default:u(()=>[o(w,{modelValue:n.rePassword,"onUpdate:modelValue":e[5]||(e[5]=a=>n.rePassword=a),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),o(_,null,{default:u(()=>[o(t,{type:"primary",onClick:e[6]||(e[6]=a=>B())},{default:u(()=>[i(d(s(l)("utils.save")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(D,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:s(l)("utils.blockUp")+s(l)("menu.subAccount")},{default:u(()=>[o(G,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=a=>v.value=a)},{default:u(()=>[o(P,{label:100},{default:u(()=>[i(d(s(l)("utils.startUse")),1)]),_:1}),o(P,{label:1e3},{default:u(()=>[i(" 100"+d(s(l)("utils.year")),1)]),_:1}),o(P,{label:999},{default:u(()=>[o(z,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),type:"datetime",style:{width:"180px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),_e,o(t,{type:"primary",style:{"margin-top":"1em"},onClick:e[10]||(e[10]=a=>K())},{default:u(()=>[i(d(s(l)("utils.save")),1)]),_:1})]),_:1},8,["modelValue","title"]),o(D,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=a=>C.value=a),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:s(l)("utils.delete")+s(l)("menu.subAccount")},{default:u(()=>[i(d(s(l)("utils.deleteTip"))+" ",1),o(w,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=a=>x.value=a)},null,8,["modelValue"]),o(t,{type:"primary",style:{"margin-top":"1em"},onClick:e[13]||(e[13]=a=>H())},{default:u(()=>[i(d(s(l)("utils.save")),1)]),_:1})]),_:1},8,["modelValue","title"])],64)}}});export{Ye as default};
