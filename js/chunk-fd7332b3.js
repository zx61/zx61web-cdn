import{d as T,e as Y,u as k,r as y,g as x,ac as $,bC as j,o as E,c as N,b as v,t as u,h as l,j as h,k as H,w as n,l as C,i as t,F as z,bD as A,E as m,bE as O,q as I,z as G,p as J,a as K,_ as Q}from"./chunk-a0327024.js";import{E as W,a as X}from"./chunk-a1e2e944.js";import"./chunk-150316ab.js";import{E as Z}from"./chunk-d22e67fd.js";import{a as ee,E as se}from"./chunk-84999d20.js";import{E as oe}from"./chunk-9ab6077c.js";import{d as S,b as D}from"./chunk-bb59191b.js";import"./chunk-1bfc73b0.js";import"./chunk-9519ab40.js";const F=_=>(J("data-v-8fb24bda"),_=_(),K(),_),te=F(()=>v("br",null,null,-1)),ae=F(()=>v("br",null,null,-1)),le={key:0},re=T({__name:"index",setup(_){const{t:s}=Y(),c=k(),f=y([]),P=c.getUserItem("type")!="subAccount",p=y(s("utils.send")),r=x({emailCode:"",password:"",rePassword:""}),V=y(),w=y(!1),U=x({emailCode:[{validator:(a,e,o)=>{e===""&&o(new Error(s("login.emailCodeNull"))),isNaN(Number(e))&&o(new Error(s("login.errorEmailCode"))),o()},trigger:"blur"}],password:[{validator:(a,e,o)=>{e===""&&o(new Error(s("login.passwordNull"))),D(e)||o(new Error(s("login.errorPassword"))),o()},trigger:"blur"}],rePassword:[{validator:(a,e,o)=>{e===""&&o(new Error(s("login.passwordNull"))),D(e)||o(new Error(s("login.errorPassword"))),e!=r.password&&o(new Error(s("login.eeSetPasswordNotMatch"))),o()},trigger:"blur"}]}),B=async()=>{const a=await A();if(a.data.data=="success"){if(m.success(s("login.sendCodeSuccess")),p.value!=s("utils.send")&&p.value!=s("utils.reSend"))return;let e=60;const o=()=>{--e>0?(p.value=e.toString(),setTimeout(o,1e3)):p.value=s("utils.reSend")};o()}else m.error(a.data.msg),a.data.msg=="sendEmailCode fail"&&m.error("server error")},M=async()=>{var o;if(!await((o=V.value)==null?void 0:o.validate(i=>(i||m.error(s("login.errorData")),i))))return;const e=await O({emailCode:Number(r.emailCode),password:I(r.password,c.getUserItem("email")),rePassword:I(r.rePassword,S(c.getUserItem("birthday")).valueOf().toString())});e.data.msg?m.error(e.data.msg):(m.success(e.data.data),w.value=!1)};return $(async()=>{if(c.getUserItem("qsession")){const a=await j();if(a&&a.data.msg!="user not login"){f.value=a.data.data.operationLogs;for(let e=0;e<f.value.length;e++){const o=f.value[e];o.timestamp=S(o.timestamp).format("YYYY-MM-DD HH:mm:ss")}}}}),(a,e)=>{const o=G,i=oe,g=ee,R=se,q=Z,b=W,L=X;return E(),N(z,null,[v("h1",null,u(l(s)("utils.securityCenter")),1),te,ae,P?(E(),N("h2",le,u(l(s)("utils.changePassword")),1)):h("",!0),P?(E(),H(o,{key:1,type:"primary",onClick:e[0]||(e[0]=d=>w.value=!0),style:{"margin-left":"1rem"}},{default:n(()=>[C(u(l(s)("utils.changePassword")),1)]),_:1})):h("",!0),t(q,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=d=>w.value=d),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:l(s)("utils.changePassword")},{default:n(()=>[t(R,{class:"secuityForm","label-width":"100px",model:r,rules:U,ref_key:"securityFormRef",ref:V},{default:n(()=>[t(g,{label:l(s)("utils.emailCode"),prop:"emailCode"},{default:n(()=>[t(i,{style:{width:"76%"},modelValue:r.emailCode,"onUpdate:modelValue":e[1]||(e[1]=d=>r.emailCode=d)},null,8,["modelValue"]),t(o,{style:{width:"20%",margin:"0 0 0 4%"},type:"primary",onClick:e[2]||(e[2]=d=>B())},{default:n(()=>[C(u(p.value),1)]),_:1})]),_:1},8,["label"]),t(g,{label:l(s)("utils.password"),prop:"password"},{default:n(()=>[t(i,{modelValue:r.password,"onUpdate:modelValue":e[3]||(e[3]=d=>r.password=d),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),t(g,{label:l(s)("utils.rePassword"),prop:"rePassword"},{default:n(()=>[t(i,{modelValue:r.rePassword,"onUpdate:modelValue":e[4]||(e[4]=d=>r.rePassword=d),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),t(g,null,{default:n(()=>[t(o,{type:"primary",onClick:e[5]||(e[5]=d=>M())},{default:n(()=>[C(u(l(s)("utils.save")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),v("h2",null,u(l(s)("utils.operationLogs")),1),t(L,{data:f.value,"max-height":"500"},{default:n(()=>[t(b,{label:l(s)("utils.operationLogs")},{default:n(()=>[t(b,{prop:"type",label:l(s)("utils.type")},null,8,["label"]),t(b,{prop:"ip",label:"ip"}),t(b,{prop:"timestamp",label:l(s)("utils.time")},null,8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])],64)}}});const ye=Q(re,[["__scopeId","data-v-8fb24bda"]]);export{ye as default};
