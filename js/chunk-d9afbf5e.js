import{d as T,e as Y,u as k,r as v,g as x,ac as $,bC as j,o as E,c as N,b,t as u,h as l,j as h,k as H,w as n,l as C,i as a,F as z,bD as O,E as m,bE as A,q as I,z as G,p as J,a as K,_ as Q}from"./chunk-0f9d6c2a.js";import{E as W,a as X}from"./chunk-ecdde5c6.js";import"./chunk-3673b403.js";import{E as Z}from"./chunk-5128ff31.js";import{a as ee,E as se}from"./chunk-f493cd2a.js";import{E as oe}from"./chunk-49932925.js";import{d as S,b as D}from"./chunk-de096472.js";import"./chunk-9b92dfcc.js";import"./chunk-9519ab40.js";const F=_=>(J("data-v-3555eba8"),_=_(),K(),_),ae=F(()=>b("br",null,null,-1)),te=F(()=>b("br",null,null,-1)),le={key:0},re=T({__name:"index",setup(_){const{t:s}=Y(),c=k(),w=v([]),P=c.getUserItem("type")=="account",p=v(s("utils.send")),r=x({emailCode:"",password:"",rePassword:""}),V=v(),f=v(!1),U=x({emailCode:[{validator:(t,e,o)=>{e===""&&o(new Error(s("login.emailCodeNull"))),isNaN(Number(e))&&o(new Error(s("login.errorEmailCode"))),o()},trigger:"blur"}],password:[{validator:(t,e,o)=>{e===""&&o(new Error(s("login.passwordNull"))),D(e)||o(new Error(s("login.errorPassword"))),o()},trigger:"blur"}],rePassword:[{validator:(t,e,o)=>{e===""&&o(new Error(s("login.passwordNull"))),D(e)||o(new Error(s("login.errorPassword"))),e!=r.password&&o(new Error(s("login.eeSetPasswordNotMatch"))),o()},trigger:"blur"}]}),B=async()=>{const t=await O();if(t.data.data=="success"){if(m.success(s("login.sendCodeSuccess")),p.value!=s("utils.send")&&p.value!=s("utils.reSend"))return;let e=60;const o=()=>{--e>0?(p.value=e.toString(),setTimeout(o,1e3)):p.value=s("utils.reSend")};o()}else m.error(t.data.msg),t.data.msg=="sendEmailCode fail"&&m.error("server error")},M=async()=>{var o;if(!await((o=V.value)==null?void 0:o.validate(d=>(d||m.error(s("login.errorData")),d))))return;const e=await A({emailCode:Number(r.emailCode),password:I(r.password,c.getUserItem("email")),rePassword:I(r.rePassword,S(c.getUserItem("birthday")).valueOf().toString())});e.data.msg?m.error(e.data.msg):(m.success(e.data.data),f.value=!1)};return $(async()=>{if(c.getUserItem("qsession")){const t=await j();if(t&&t.data.msg!="user not login"){w.value=t.data.data.operationLogs;for(let e=0;e<w.value.length;e++){const o=w.value[e];o.timestamp=S(o.timestamp).format("YYYY-MM-DD HH:mm:ss")}}}}),(t,e)=>{const o=G,d=oe,g=ee,R=se,q=Z,y=W,L=X;return E(),N(z,null,[b("h1",null,u(l(s)("utils.securityCenter")),1),ae,te,P?(E(),N("h2",le,u(l(s)("utils.changePassword")),1)):h("",!0),P?(E(),H(o,{key:1,type:"primary",onClick:e[0]||(e[0]=i=>f.value=!0),style:{"margin-left":"1rem"}},{default:n(()=>[C(u(l(s)("utils.changePassword")),1)]),_:1})):h("",!0),a(q,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=i=>f.value=i),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:l(s)("utils.changePassword")},{default:n(()=>[a(R,{class:"secuityForm","label-width":"100px",model:r,rules:U,ref_key:"securityFormRef",ref:V},{default:n(()=>[a(g,{label:l(s)("utils.emailCode"),prop:"emailCode"},{default:n(()=>[a(d,{style:{width:"76%"},modelValue:r.emailCode,"onUpdate:modelValue":e[1]||(e[1]=i=>r.emailCode=i)},null,8,["modelValue"]),a(o,{style:{width:"20%",margin:"0 0 0 4%"},type:"primary",onClick:e[2]||(e[2]=i=>B())},{default:n(()=>[C(u(p.value),1)]),_:1})]),_:1},8,["label"]),a(g,{label:l(s)("utils.password"),prop:"password"},{default:n(()=>[a(d,{modelValue:r.password,"onUpdate:modelValue":e[3]||(e[3]=i=>r.password=i),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),a(g,{label:l(s)("utils.rePassword"),prop:"rePassword"},{default:n(()=>[a(d,{modelValue:r.rePassword,"onUpdate:modelValue":e[4]||(e[4]=i=>r.rePassword=i),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),a(g,null,{default:n(()=>[a(o,{type:"primary",onClick:e[5]||(e[5]=i=>M())},{default:n(()=>[C(u(l(s)("utils.save")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),b("h2",null,u(l(s)("utils.operationLogs")),1),a(L,{data:w.value,"max-height":"500"},{default:n(()=>[a(y,{label:l(s)("utils.operationLogs")},{default:n(()=>[a(y,{prop:"type",label:l(s)("utils.type")},null,8,["label"]),a(y,{prop:"ip",label:"ip"}),a(y,{prop:"timestamp",label:l(s)("utils.time")},null,8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])],64)}}});const ve=Q(re,[["__scopeId","data-v-3555eba8"]]);export{ve as default};
