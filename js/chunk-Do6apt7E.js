import{d as L,v as T,u as Y,r as y,e as I,ad as k,bh as q,o as E,c as x,b,t as u,f as s,i as N,j as $,w as n,k as C,g as t,F as H,bi as z,E as m,bj as A,n as h,z as G,p as J,a as K,_ as O}from"./chunk-DP0Z30vw.js";import{E as Q,a as W}from"./chunk-Bml0By_C.js";import"./chunk-BMfCrhL0.js";import"./chunk-Bl2VGQif.js";import{E as X}from"./chunk-BCXlRYD5.js";import{a as Z,E as ee}from"./chunk-D8c60Fvd.js";import{E as oe}from"./chunk-CTCkpdwj.js";import{d as ae,b as S}from"./chunk-ChiXr7LY.js";import"./chunk-0uz-bf1k.js";import"./chunk-CaX16Gad.js";import"./chunk-H84q2nlw.js";import"./chunk-BB_Ol6Sd.js";import"./chunk-Ch5bfSqd.js";const U=f=>(J("data-v-fcdc8297"),f=f(),K(),f),te=U(()=>b("br",null,null,-1)),se=U(()=>b("br",null,null,-1)),re={key:0},le=L({__name:"index",setup(f){const{t:o}=T.useI18n(),p=Y(),w=y([]),P=p.getUserItem("type")&&p.getUserItem("type")!="subAccount",c=y(o("utils.send")),l=I({emailCode:"",password:"",rePassword:""}),V=y(),g=y(!1),F=I({emailCode:[{validator:(r,e,a)=>{e===""&&a(new Error(o("login.emailCodeNull"))),isNaN(Number(e))&&a(new Error(o("login.errorEmailCode"))),a()},trigger:"blur"}],password:[{validator:(r,e,a)=>{e===""&&a(new Error(o("login.passwordNull"))),S(e)||a(new Error(o("login.errorPassword"))),a()},trigger:"blur"}],rePassword:[{validator:(r,e,a)=>{e===""&&a(new Error(o("login.passwordNull"))),S(e)||a(new Error(o("login.errorPassword"))),e!=l.password&&a(new Error(o("login.eeSetPasswordNotMatch"))),a()},trigger:"blur"}]}),D=async()=>{const r=await z();if(r.data.data=="success"){if(m.success(o("login.sendCodeSuccess")),c.value!=o("utils.send")&&c.value!=o("utils.reSend"))return;let e=60;const a=()=>{--e>0?(c.value=e.toString(),setTimeout(a,1e3)):c.value=o("utils.reSend")};a()}else m.error(r.data.msg),r.data.msg=="sendEmailCode fail"&&m.error("server error")},B=async()=>{var a;if(!await((a=V.value)==null?void 0:a.validate(i=>(i||m.error(o("login.errorData")),i))))return;const e=await A({emailCode:Number(l.emailCode),password:h(l.password,p.getUserItem("email")),rePassword:h(l.rePassword,p.getUserItem("birthday"))});e.data.msg?m.error(e.data.msg):(m.success(e.data.data),g.value=!1)};return k(async()=>{if(p.getUserItem("qsession")){const r=await q();if(r&&r.data.msg!="user not login"){w.value=r.data.data.operationLogs;for(let e=0;e<w.value.length;e++){const a=w.value[e];a.timestamp=ae(a.timestamp).format("YYYY-MM-DD HH:mm:ss")}}}}),(r,e)=>{const a=G,i=oe,_=Z,M=ee,R=X,v=Q,j=W;return E(),x(H,null,[b("h1",null,u(s(o)("utils.securityCenter")),1),te,se,s(P)?(E(),x("h2",re,u(s(o)("account.changePassword")),1)):N("",!0),s(P)?(E(),$(a,{key:1,type:"primary",onClick:e[0]||(e[0]=d=>g.value=!0),style:{"margin-left":"1rem"}},{default:n(()=>[C(u(s(o)("account.changePassword")),1)]),_:1})):N("",!0),t(R,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=d=>g.value=d),"align-center":"","destroy-on-close":"",style:{"max-width":"600px"},title:s(o)("account.changePassword")},{default:n(()=>[t(M,{class:"secuityForm","label-width":"100px",model:l,rules:F,ref_key:"securityFormRef",ref:V},{default:n(()=>[t(_,{label:s(o)("account.emailCode"),prop:"emailCode"},{default:n(()=>[t(i,{style:{width:"76%"},modelValue:l.emailCode,"onUpdate:modelValue":e[1]||(e[1]=d=>l.emailCode=d)},null,8,["modelValue"]),t(a,{style:{width:"20%",margin:"0 0 0 4%"},type:"primary",onClick:e[2]||(e[2]=d=>D())},{default:n(()=>[C(u(c.value),1)]),_:1})]),_:1},8,["label"]),t(_,{label:s(o)("account.password"),prop:"password"},{default:n(()=>[t(i,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=d=>l.password=d),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),t(_,{label:s(o)("account.rePassword"),prop:"rePassword"},{default:n(()=>[t(i,{modelValue:l.rePassword,"onUpdate:modelValue":e[4]||(e[4]=d=>l.rePassword=d),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),t(_,null,{default:n(()=>[t(a,{type:"primary",onClick:e[5]||(e[5]=d=>B())},{default:n(()=>[C(u(s(o)("utils.save")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),b("h2",null,u(s(o)("account.operationLogs")),1),t(j,{data:w.value,"max-height":"500"},{default:n(()=>[t(v,{label:s(o)("account.operationLogs")},{default:n(()=>[t(v,{prop:"type",label:s(o)("account.type")},null,8,["label"]),t(v,{prop:"ip",label:"ip"}),t(v,{prop:"timestamp",label:s(o)("account.time")},null,8,["label"])]),_:1},8,["label"])]),_:1},8,["data"])],64)}}}),Pe=O(le,[["__scopeId","data-v-fcdc8297"]]);export{Pe as default};
